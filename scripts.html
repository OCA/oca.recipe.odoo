
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Odoo Scripts &#8212; Odoo buildout recipe 1.9.3.dev0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Full development to production example" href="dev_prod_workflow.html" />
    <link rel="prev" title="Configuration reference" href="configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/logo.png"></span>
          Odoo buildout recipe</a>
        <span class="navbar-text navbar-version pull-left"><b>1.9</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Home</a></li>
                <li><a href="https://odoo-community.org">OCA</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">First steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#how-to-create-and-bootstrap-a-buildout">How to create and bootstrap a buildout</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#example-openerp-7-0-buildouts">Example OpenERP 7.0 buildouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#example-openerp-6-1-buildout-with-a-custom-addon">Example OpenERP 6.1 buildout with a custom addon</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#example-openerp-6-0-buildout-server-and-clients">Example OpenERP 6.0 buildout (server and clients)</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#continuously-tested-examples">Continuously tested examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_steps.html#other-sample-buildouts">Other sample buildouts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#the-buildout-configuration-file-and-parts">The buildout configuration file and parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#odoo-recipes">Odoo recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-assembly-and-source-management">Options for assembly and source management</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-buildout-relocation">Options for buildout relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#odoo-options">Odoo options</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-executables-generation-and-serving">Options for executables generation and serving</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-development-qa-and-introspection">Options for development, QA and introspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-download-and-caching-strategies">Options for download and caching strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#options-for-release-and-packaging">Options for release and packaging</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Odoo Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use-cases">Use cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#declaring-odoo-scripts">Declaring Odoo Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-consoles">Interactive Consoles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-odoo-scripts">Writing Odoo Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-scripts">Upgrade scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#startup-scripts">Startup scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-internal-entry-points">List of internal entry points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_prod_workflow.html">Full development to production example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_prod_workflow.html#common-setup">Common setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_prod_workflow.html#developer-s-setup">Developer’s setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_prod_workflow.html#release-and-packaging">Release and packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_prod_workflow.html#deployment-with-a-server-local-configuration-file">Deployment with a server-local configuration file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">For contributors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#source-and-tracking">Source and tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#using-a-development-version">Using a development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#development-setup">Development setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#building-documentation">Building documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#coding-style">Coding style</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#launching-static-analysis-and-unit-tests">Launching static analysis and unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#integration-tests">Integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#continuous-integration">Continuous integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="devnotes/index.html">Development notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="devnotes/git-sparse-shallow.html">Git shallow clones and selective branch fetching</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apidoc/oca.recipe.odoo.html">oca.recipe.odoo Package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oca.recipe.odoo</span></code> Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#module-oca.recipe.odoo.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">base</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#module-oca.recipe.odoo.devtools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devtools</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#module-oca.recipe.odoo.server"><code class="xref py py-mod docutils literal notranslate"><span class="pre">server</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#module-oca.recipe.odoo.testing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">testing</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#module-oca.recipe.odoo.utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utils</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html">runtime Subpackage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime"><code class="xref py py-mod docutils literal notranslate"><span class="pre">runtime</span></code> Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime.session"><code class="xref py py-mod docutils literal notranslate"><span class="pre">session</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime.upgrade"><code class="xref py py-mod docutils literal notranslate"><span class="pre">upgrade</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime.start_odoo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">start_openerp</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime.test_odoo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test_openerp</span></code> Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html">vcs Subpackage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vcs</span></code> Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">base</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.bzr"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bzr</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.git"><code class="xref py py-mod docutils literal notranslate"><span class="pre">git</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.hg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hg</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.svn"><code class="xref py py-mod docutils literal notranslate"><span class="pre">svn</span></code> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/oca.recipe.odoo.vcs.html#module-oca.recipe.odoo.vcs.testing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">testing</span></code> Module</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Odoo Scripts</a><ul>
<li><a class="reference internal" href="#use-cases">Use cases</a><ul>
<li><a class="reference internal" href="#odoo-vs-rpc-scripts-for-administrative-tasks">Odoo vs RPC scripts for administrative tasks</a></li>
<li><a class="reference internal" href="#odoo-scripts-vs-odoo-cron-jobs">Odoo scripts vs Odoo cron jobs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#declaring-odoo-scripts">Declaring Odoo Scripts</a><ul>
<li><a class="reference internal" href="#bare-declararations">Bare declararations</a></li>
<li><a class="reference internal" href="#arguments-and-session">Arguments and session</a></li>
<li><a class="reference internal" href="#command-line-options">Command-line options</a></li>
<li><a class="reference internal" href="#odoo-log-level">Odoo log level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interactive-consoles">Interactive Consoles</a></li>
<li><a class="reference internal" href="#writing-odoo-scripts">Writing Odoo Scripts</a><ul>
<li><a class="reference internal" href="#making-the-distribution-available">Making the distribution available</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrade-scripts">Upgrade scripts</a><ul>
<li><a class="reference internal" href="#usage-for-instance-creation">Usage for instance creation</a></li>
<li><a class="reference internal" href="#options-of-the-produced-executable-upgrade-script">Options of the produced executable upgrade script</a></li>
<li><a class="reference internal" href="#sample-output">Sample output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#startup-scripts">Startup scripts</a></li>
<li><a class="reference internal" href="#list-of-internal-entry-points">List of internal entry points</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="configuration.html" title="Previous Chapter: Configuration reference"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Configuration...</span>
    </a>
  </li>
  <li>
    <a href="dev_prod_workflow.html" title="Next Chapter: Full development to production example"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Full developm... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/scripts.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="odoo-scripts">
<h1>Odoo Scripts<a class="headerlink" href="#odoo-scripts" title="Permalink to this headline">¶</a></h1>
<p>The server recipe actually includes a general engine to install Python
code that needs access to the Odoo API and build
configuration-aware executables.</p>
<p>As usual, it tries and do so by bridging the standard Python packaging
practice (setuptools-style console scripts, as in
<code class="docutils literal notranslate"><span class="pre">zc.recipe.egg:scripts</span></code>) and Odoo specificities.</p>
<p>We call such scripts <em>Odoo scripts</em> to distinguish them among the
more general concept of console scripts.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Odoo scripts are currently supported for versions ≥ 6.1 only.</p>
</div>
<section id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<p>Odoo scripts can do great in situations where an RPC script might
not be powerful enough or not practical. Some examples:</p>
<ul class="simple">
<li><p>specific batch jobs, especially for large databases (you get to
control the transaction).</p></li>
<li><p>introspection tools.</p></li>
<li><p>general-purposes test launchers that don’t have any knowledge of
Odoo specifics, such as <code class="docutils literal notranslate"><span class="pre">nose</span></code>. See <a class="reference internal" href="#command-line-options"><span class="std std-ref">Command-line options</span></a>
for details about that.</p></li>
<li><p>Enhanced Python consoles, like <code class="docutils literal notranslate"><span class="pre">IPython</span></code> or <code class="docutils literal notranslate"><span class="pre">bpython</span></code>.
See <a class="reference internal" href="#interactive-consoles"><span class="std std-ref">Interactive Consoles</span></a>.</p></li>
</ul>
<section id="odoo-vs-rpc-scripts-for-administrative-tasks">
<h3>Odoo vs RPC scripts for administrative tasks<a class="headerlink" href="#odoo-vs-rpc-scripts-for-administrative-tasks" title="Permalink to this headline">¶</a></h3>
<p>There are several Python distributions that wrap the Odoo RPC APIs
for easy use within Python code.</p>
<p>Using an RPC script for administrative tasks usually leads to
wrap it in a shell script, with the admin password in clear text.</p>
<p>In this author’s experience of applicative maintainance,
this always turns to be an
easy source of breakage that may look to be trivial at first sight but
has actually two nasty properties : it may stay unnoticed for a while,
and it lies at the interface between responsibilities.</p>
<p>In case of password change, the persons who can do it
in the database and in the system usually differ, and may not
communicate on a regular basis. In enterprise hosting environments,
you may have to explain stuff to several project managers with
different responsabilities, go through crisis management meetings,
etc. Who wants to waste hours of their life interacting with people
under stress to try and persuade them that it’s only a matter of
changing an obscure password ?</p>
</section>
<section id="odoo-scripts-vs-odoo-cron-jobs">
<h3>Odoo scripts vs Odoo cron jobs<a class="headerlink" href="#odoo-scripts-vs-odoo-cron-jobs" title="Permalink to this headline">¶</a></h3>
<p>Because they are part of addons, Odoo cron jobs also have full
unrestricted access to the internal API, and obviously don’t suffer
from the password plague.</p>
<p>Some ideas to make a choice:</p>
<ul class="simple">
<li><p>who should control, schedule and tune execution (a system administrator or
a functional admin)</p></li>
<li><p>which one the script author finds easiest to write for</p></li>
<li><p>reuse and distribution issues : Odoo scripts are in Python
distributions, cron jobs are in addons.</p></li>
<li><p>Odoo scripts must implement their own transaction control,
whereas cron jobs don’t bother about it but rely on the framework’s
decisions.</p></li>
</ul>
<p>Perhaps, the best is not to choose : put the bulk of the logic in some
technical addon, it’s easy to rewrap it in an Odoo script and as a
cron job.</p>
</section>
</section>
<section id="declaring-odoo-scripts">
<h2>Declaring Odoo Scripts<a class="headerlink" href="#declaring-odoo-scripts" title="Permalink to this headline">¶</a></h2>
<p>There are several cases, depending on the script authors
intentions. Script authors should therefore state clearly in their
documentation how to declare them.</p>
<p>Assume to fix ideas there is a Python distribution <code class="docutils literal notranslate"><span class="pre">my.script</span></code>
that declares a console script entry point named <code class="docutils literal notranslate"><span class="pre">my_script</span></code> in its
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">[console_scripts]</span>
<span class="s2">my_script = my.script.main:run</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The first thing to do is to require that distribution using the
<code class="docutils literal notranslate"><span class="pre">eggs</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">my</span><span class="o">-</span><span class="n">openerp</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">eggs</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">script</span>
</pre></div>
</div>
<p><a class="reference internal" href="#making-available"><span class="std std-ref">How that distribution can be made available to buildout</span></a> is a different question.</p>
<section id="bare-declararations">
<h3>Bare declararations<a class="headerlink" href="#bare-declararations" title="Permalink to this headline">¶</a></h3>
<p>The following configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="o">-</span><span class="n">one</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">my_script</span>
</pre></div>
</div>
<p>Produces an executable <code class="docutils literal notranslate"><span class="pre">bin/my_script-openerp-one</span></code>, that can import
Odoo server and addons code, and in which the Odoo configuration
related to the appropriate buildout part (here, <code class="docutils literal notranslate"><span class="pre">openerp-one</span></code>) is
loaded in the standard <code class="docutils literal notranslate"><span class="pre">openerp.tools.config</span></code>, for use in the
script. The script has to take care of all database management operations.</p>
<p>Optionally, it’s possible to specify the name of the produced script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="o">-</span><span class="n">one</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">my_script</span><span class="o">=</span><span class="n">wished_name</span>
</pre></div>
</div>
<p>That would build the script as <code class="docutils literal notranslate"><span class="pre">bin/wished_name</span></code>.</p>
<p>This is good
enough for scripts that’d take care of many bootstrapping details, but
there is a more integrated way that script authors should be aware of:
the special <code class="docutils literal notranslate"><span class="pre">session</span></code> argument.</p>
</section>
<section id="arguments-and-session">
<span id="arguments-session"></span><h3>Arguments and session<a class="headerlink" href="#arguments-and-session" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>new in version 1.7.0</p>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">arguments</span></code> parameter, similar to the one of
<code class="docutils literal notranslate"><span class="pre">zc.recipe.egg:scripts</span></code> can be specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="o">-</span><span class="n">two</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">my_script</span> <span class="n">arguments</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
</pre></div>
</div>
<p>This is a raw string that will be used as the string of arguments for
the callable specified in the entry point, as in <code class="docutils literal notranslate"><span class="pre">main(2,3)</span></code> in that
example.</p>
<p>There is a special argument: <code class="docutils literal notranslate"><span class="pre">session</span></code>, which is an object provided
by the recipe to expose Odoo API in a convenient manner for script
authors. Check
<a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#oca.recipe.odoo.runtime.session.Session" title="oca.recipe.odoo.runtime.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">oca.recipe.odoo.runtime.session.Session</span></code></a> to learn
what can be done with it.</p>
<p>Scripts written for these <code class="docutils literal notranslate"><span class="pre">session</span></code> objects must be declared as such:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="o">-</span><span class="n">two</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">my_script</span> <span class="n">arguments</span><span class="o">=</span><span class="n">session</span>
</pre></div>
</div>
</section>
<section id="command-line-options">
<span id="id1"></span><h3>Command-line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h3>
<p>In some cases, it is useful to do some operations, such as preloading
a database, before actual running of the script. This is intended for
scripts which have no special knowledge of Odoo but may in turn
call some code meant for Odoo, that’d need some preparations to
already have been performed.</p>
<p>The main use-case is unit tests launchers.</p>
<p>For these, the <code class="docutils literal notranslate"><span class="pre">command-line-options</span></code> modifier tells the recipe to
produce an executable that will implement some additional command-line
options parsing and perform some actions accordingly. On the
command-line <code class="docutils literal notranslate"><span class="pre">--</span></code> is used as a separator between those additional
options and the regular arguments expected by the script.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="o">-</span><span class="n">three</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">nosetests</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="n">options</span><span class="o">=-</span><span class="n">d</span>
</pre></div>
</div>
<p>This produces a <code class="docutils literal notranslate"><span class="pre">bin/nosetests_openerp-three</span></code>, which you can use
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">nosetests_openerp</span><span class="o">-</span><span class="n">three</span> <span class="o">-</span><span class="n">d</span> <span class="n">mydb</span> <span class="o">--</span> <span class="p">[</span><span class="n">NOSE</span> <span class="n">REGULAR</span> <span class="n">OPTIONS</span> <span class="o">&amp;</span> <span class="n">ARGUMENTS</span><span class="p">]</span>
</pre></div>
</div>
<p>Currently available command-line-options:</p>
<dl class="field-list simple">
<dt class="field-odd">-d DB_NAME</dt>
<dd class="field-odd"><p>preload the specified database</p>
</dd>
</dl>
</section>
<section id="odoo-log-level">
<span id="openerp-log-level"></span><h3>Odoo log level<a class="headerlink" href="#odoo-log-level" title="Permalink to this headline">¶</a></h3>
<p>This is mostly meant for scripts with the <code class="docutils literal notranslate"><span class="pre">command-line-options=-d</span></code>
modifier.</p>
<p>In some cases, one is not interested in the logs during the Odoo
database load. The typical use-case this has been made for is the
<code class="docutils literal notranslate"><span class="pre">sphinx-build</span></code> script, where any warning from Odoo would just
make it harder to stop actual documentation warnings, or to limit the
output of test launcher before actual testing begins.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">openerp_log_level</span></code> modifier lets you specify the log level for
the <code class="docutils literal notranslate"><span class="pre">openerp</span></code> logger, at the very start of the script, before any
database loading is performed.</p>
<p>In the case of <code class="docutils literal notranslate"><span class="pre">sphinx-build</span></code> this has the advantage of not
affecting the root logger nor the Sphinx dedicated ones.</p>
<p>Of course, the actual script can override that setting once it really
starts, in which case the modifier is really only about the loading sequence.</p>
</section>
</section>
<section id="interactive-consoles">
<span id="id2"></span><h2>Interactive Consoles<a class="headerlink" href="#interactive-consoles" title="Permalink to this headline">¶</a></h2>
<p>One particularly interesting use of <cite>openerp_scripts</cite> is to enable the use of
enhanced Python interactive interpreters, like <a class="reference external" href="http://ipython.org">IPython</a>
or <a class="reference external" href="http://bpython-interpreter.org">bPython</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">buildout</span><span class="p">]</span>
<span class="n">parts</span> <span class="o">=</span> <span class="n">odoo</span>

<span class="p">[</span><span class="n">odoo</span><span class="p">]</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">git</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">odoo</span><span class="o">/</span><span class="n">odoo</span><span class="o">.</span><span class="n">git</span> <span class="n">odoo</span> <span class="mf">8.0</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span>
<span class="n">recipe</span> <span class="o">=</span> <span class="n">oca</span><span class="o">.</span><span class="n">recipe</span><span class="o">.</span><span class="n">odoo</span><span class="p">:</span><span class="n">server</span>
<span class="n">eggs</span> <span class="o">=</span>
    <span class="n">ipython</span>
    <span class="n">bpython</span>
<span class="n">openerp_scripts</span> <span class="o">=</span>
    <span class="n">ipython</span> <span class="n">arguments</span><span class="o">=</span><span class="n">user_ns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
    <span class="n">bpython</span> <span class="n">arguments</span><span class="o">=</span><span class="n">locals_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
<p>The example <code class="docutils literal notranslate"><span class="pre">buildout.cfg</span></code> above will generate both a <code class="docutils literal notranslate"><span class="pre">ipython_odoo</span></code> and a
<code class="docutils literal notranslate"><span class="pre">bpython_odoo</span></code> scripts in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory, which can be used like the
Python interpreter generated by <a class="reference internal" href="configuration.html#interpreter-name"><span class="std std-ref">interpreter_name</span></a>, where the <code class="docutils literal notranslate"><span class="pre">session</span></code>
object is available for interacting with your odoo application and database.</p>
<p>Keep in mind that <code class="docutils literal notranslate"><span class="pre">bpython</span></code> requires more system dependencies installed than
plain <code class="docutils literal notranslate"><span class="pre">odoo</span></code>.</p>
<p>Note that Odoo forbids using the <code class="docutils literal notranslate"><span class="pre">postgres</span></code> user to connect to the database.
But in some containerized environments (Docker), using <code class="docutils literal notranslate"><span class="pre">postgres</span></code> can be
both safe and handy. In such case you would need to patch the Odoo server as
of today. But for the interactives sessions of this buildout recipe, you can
set the environment variable ENABLE_POSTGRES_USER=1 before opening the console
to disable the default <code class="docutils literal notranslate"><span class="pre">check_postgres_user()</span></code> guard and enable the postgres
user.</p>
</section>
<section id="writing-odoo-scripts">
<h2>Writing Odoo Scripts<a class="headerlink" href="#writing-odoo-scripts" title="Permalink to this headline">¶</a></h2>
<p>Script authors have to:</p>
<ul>
<li><p>write their script as a callable within a setuptools
distribution. Usually that’d be a function <code class="docutils literal notranslate"><span class="pre">my_run</span></code> at toplevel of
a <code class="docutils literal notranslate"><span class="pre">my/script/main.py</span></code> file</p></li>
<li><p>declare that callable in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">[console_scripts]</span>
<span class="s2">my_script = my.script.main:my_run</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p>(recommended) use the
<a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#oca.recipe.odoo.runtime.session.Session" title="oca.recipe.odoo.runtime.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">oca.recipe.odoo.runtime.session.Session</span></code></a> API. For
that, let your callable accept a <code class="docutils literal notranslate"><span class="pre">session</span></code> argument, and tell
users to <a class="reference internal" href="#arguments-session"><span class="std std-ref">pass it in their buildout configuration</span></a>.</p></li>
<li><p>write the actual script! Here’s a silly example, that outputs the
total of users in the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentsParser</span>

<span class="k">def</span> <span class="nf">my_run</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c1"># command-line arguments handling is up to the script</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentsParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--database&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Database to work on&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># loading the DB</span>
    <span class="n">session</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>

    <span class="c1"># using the models</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">registry</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">session</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="p">[])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> users in database </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">),</span> <span class="n">arguments</span><span class="o">.</span><span class="n">database</span><span class="p">))</span>

    <span class="c1"># Transaction control is up to the script</span>
    <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>  <span class="c1"># we didn&#39;t write anything, but one never knows</span>
</pre></div>
</div>
</li>
</ul>
<section id="making-the-distribution-available">
<span id="making-available"></span><h3>Making the distribution available<a class="headerlink" href="#making-the-distribution-available" title="Permalink to this headline">¶</a></h3>
<p>In order to be used by the recipe, the distribution that holds the
script code has to be <em>required</em> with the <code class="docutils literal notranslate"><span class="pre">eggs</span></code> option. But how can
buildout retrieve it ? There’s nothing specific to the Odoo recipe
about that, it works in the exact same way as for the standard
<code class="docutils literal notranslate"><span class="pre">zc.recipe.eggs</span></code> recipe.</p>
<p>We list here some possibilities, as a convenience for readers without
a more general buildout experience.</p>
<ul>
<li><p>provide it locally and tell buildout to “develop” it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">buildout</span><span class="p">]</span>
<span class="n">develop</span> <span class="o">=</span> <span class="n">my_script_distribution_path</span>
</pre></div>
</div>
<p>paths are interpreted relative to the buildout directory, but may be
absolute.</p>
</li>
<li><p>put it on the <a class="reference external" href="https://pypi.python.org">Python Package Index</a></p></li>
<li><p>put it in a private index and use the <code class="docutils literal notranslate"><span class="pre">index</span></code> main buildout option</p></li>
<li><p>prebuild an egg and put it in the eggs directory (can be shared
between several buildouts).</p></li>
<li><p>put a source distribution (tarball) or an egg on some HTTP server,
and use the <code class="docutils literal notranslate"><span class="pre">find-links</span></code> global buildout option.</p></li>
<li><p>grab it and develop it from an external VCS, using the
<a class="reference external" href="https://pypi.python.org/gp.vcsdevelop">gp.vcsdevelop</a> buildout extension.</p></li>
<li><p>use one of the other VCS-oriented buildout extensions (such as
<a class="reference external" href="https://pypi.python.org/pypi/mr.developer/">mr.developer</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the releasing features (freeze, extract) of the recipe are
aware of <code class="docutils literal notranslate"><span class="pre">gp.vcsdevelop</span></code> and will control the revision it
uses. There’s no such support of <code class="docutils literal notranslate"><span class="pre">mr.developer</span></code> right now.</p>
</div>
</section>
</section>
<section id="upgrade-scripts">
<span id="id3"></span><h2>Upgrade scripts<a class="headerlink" href="#upgrade-scripts" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>new in version 1.8.0</p>
</div>
<p>The recipe provides a toolkit for database management, including
upgrade scripts generation, to fulfill two seemingly contradictory goals:</p>
<ul class="simple">
<li><p><strong>Uniformity</strong>: all buildout-driven
installations have upgrade scripts with the same command-line
arguments, similar output, and all the costly details that matter
for industrialisation, or simply execution by a pure system
administrator, such as success log line, proper status code, already
taken care of. Even for one-shot delicate upgrades, repetition is
paramount (early detection of problems through rehearsals).</p></li>
<li><p><strong>Flexibility</strong>: “one-size-fits all” is precisely what the recipe is
meant to avoid. In the sensitive case of upgrades, we know that an
guess-based approach that would work in 90% of cases is not good enough.</p></li>
</ul>
<p>To accomodate these two needs, the installation-dependent
flexibility is given back to the user (a
project maintainer in that case) by letting her write the actual
upgrade logic in the simplest way possible. The recipe rewraps it and
produces the actual executable, with its command-line parsing, etc.</p>
<p>Project maintainers have to produce a callable using the
high-level methods of
<a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#oca.recipe.odoo.runtime.session.Session" title="oca.recipe.odoo.runtime.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">oca.recipe.odoo.runtime.session.Session</span></code></a>. Here’s an
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_upgrade</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="n">db_version</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">db_version</span>  <span class="c1"># this is the state after</span>
                                     <span class="c1"># latest upgrade</span>
    <span class="k">if</span> <span class="n">db_version</span> <span class="o">&lt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">:</span>
       <span class="n">session</span><span class="o">.</span><span class="n">update_modules</span><span class="p">([</span><span class="s1">&#39;account_account&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Not upgrading account_account, as we know it &quot;</span>
                   <span class="s2">&quot;to be currently a problem with our setup. &quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">update_modules</span><span class="p">([</span><span class="s1">&#39;crm&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>No need to set <code class="docutils literal notranslate"><span class="pre">db_version</span></code>, nor to commit: the recipe will do it
for you in case of success (see below)</p>
<p>Such callables (source file and name) can be declared in the
buildout configuration with the <code class="docutils literal notranslate"><span class="pre">upgrade_script</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">upgrade_script</span> <span class="o">=</span> <span class="n">my_upgrade</span><span class="o">.</span><span class="n">py</span> <span class="n">run_upgrade</span>
</pre></div>
</div>
<p>The default is <code class="docutils literal notranslate"><span class="pre">upgrade.py</span> <span class="pre">run</span></code>. The path is interpreted relative to
the buildout directory.</p>
<p>If the specified source file is not found, the recipe will initialize it
with the simplest possible one : update of all modules. That is
expected to work 90% of the time. The package manager can then modify
it according to needs, and maybe track it in version control.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>about versions</p>
<p>the <code class="docutils literal notranslate"><span class="pre">db_version</span></code> settable property is meant to be really
global for this precise project. The idea is that anything
depending only on a module’s version number should be done
in that module’s migration scripts (pre or post).</p>
<p>you’re supposed to provide and maintain a “package version” in a
<code class="docutils literal notranslate"><span class="pre">VERSION.txt</span></code> file at the root of the buildout (the recipe
will warn you if it’s missing). The recipe will use it to set
<code class="docutils literal notranslate"><span class="pre">db_version</span></code> at the end of the process.</p>
</div>
<p>In truth, upgrade scripts are nothing but Odoo scripts, with the
entry point console script being provided by the recipe itself, and
in turn relaying to that user-level callable.
See <a class="reference internal" href="apidoc/oca.recipe.odoo.runtime.html#module-oca.recipe.odoo.runtime.upgrade" title="oca.recipe.odoo.runtime.upgrade"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oca.recipe.odoo.runtime.upgrade</span></code></a> for more details
on how it works.</p>
<section id="usage-for-instance-creation">
<h3>Usage for instance creation<a class="headerlink" href="#usage-for-instance-creation" title="Permalink to this headline">¶</a></h3>
<p>For projects with a fixed number of modules to install at a given
point of code history, upgrade scripts can be used to install a
fresh database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">upgrade</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create or upgrade an instance or my_project.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">is_initialization</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Installing modules on fresh database&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">install_modules</span><span class="p">([</span><span class="s1">&#39;my_module&#39;</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="c1"># now upgrade logic</span>
</pre></div>
</div>
<p>Not having a command-line argument for modules ot install in
the resulting script <em>is a strength</em>.
It means that CI robots, deployment tools
and the like will be able to install it with zero additional
configuration.</p>
<p>The default script produced by the recipe also detects initializations
and logs information on how to customize:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2013</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">14</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span><span class="mi">785</span> <span class="n">WARNING</span>  <span class="n">Usage</span> <span class="n">of</span> <span class="n">upgrade</span> <span class="n">script</span> <span class="k">for</span> <span class="n">initialization</span> <span class="n">detected</span><span class="o">.</span> <span class="n">You</span> <span class="n">should</span> <span class="n">consider</span> <span class="n">customizing</span> <span class="n">the</span> <span class="n">present</span> <span class="n">upgrade</span> <span class="n">script</span> <span class="n">to</span> <span class="n">add</span> <span class="n">modules</span> <span class="n">install</span> <span class="n">commands</span><span class="o">.</span> <span class="n">The</span> <span class="n">present</span> <span class="n">script</span> <span class="ow">is</span> <span class="n">at</span> <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">gracinet</span><span class="o">/</span><span class="n">openerp</span><span class="o">/</span><span class="n">recipe</span><span class="o">/</span><span class="n">testing</span><span class="o">-</span><span class="n">buildouts</span><span class="o">/</span><span class="n">upgrade</span><span class="o">.</span><span class="n">py</span> <span class="p">(</span><span class="n">byte</span><span class="o">-</span><span class="n">compiled</span> <span class="n">form</span><span class="p">)</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">14</span> <span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span><span class="mi">786</span> <span class="n">INFO</span>  <span class="n">Initialization</span> <span class="n">successful</span><span class="o">.</span> <span class="n">Total</span> <span class="n">time</span><span class="p">:</span> <span class="mi">22</span> <span class="n">seconds</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the <code class="docutils literal notranslate"><span class="pre">is_initialization</span></code> attribute is new in version 1.8.1</p>
</div>
</section>
<section id="options-of-the-produced-executable-upgrade-script">
<h3>Options of the produced executable upgrade script<a class="headerlink" href="#options-of-the-produced-executable-upgrade-script" title="Permalink to this headline">¶</a></h3>
<p>Command-line parsing is done with <a class="reference external" href="http://docs.python.org/2/library/argparse.html">argparse</a>. If you have any doubt,
use <code class="docutils literal notranslate"><span class="pre">--help</span></code> with the version you have. Here’s the current state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bin/upgrade_openerp -h
usage: upgrade_openerp [-h] [--log-file LOG_FILE] [--log-level LOG_LEVEL]
                       [--console-log-level CONSOLE_LOG_LEVEL] [-q]
                       [-d DB_NAME]

optional arguments:
  -h, --help            show this help message and exit
  --log-file LOG_FILE   File to log sub-operations to, relative to the current
                        working directory, supports homedir expansion (&#39;~&#39; on
                        POSIX systems). (default: upgrade.log)
  --log-level LOG_LEVEL
                        Main Odoo logging level. Does not affect the
                        logging from the main upgrade script itself. (default:
                        info)
  --console-log-level CONSOLE_LOG_LEVEL
                        Level for the upgrade process console logging. This is
                        for the main upgrade script itself meaning that
                        usually only major steps should be logged (default:
                        info)
  -q, --quiet           Suppress console output from the main upgrade script
                        (lower level stages can still write) (default: False)
  -d DB_NAME, --db-name DB_NAME
                        Database name. If ommitted, the general default values
                        from Odoo config file or libpq will apply.
  --init-load-demo-data
                        Demo data will be loaded with module installations if
                        and only if this modifier is specified (default:
                        False)
</pre></div>
</div>
</section>
<section id="sample-output">
<h3>Sample output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h3>
<p>Here’s the output of a run of the default upgrade script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bin/upgrade_openerp -d testrecipe
Starting upgrade, logging details to /home/gracinet/openerp/recipe/testing-buildouts/upgrade.log at level INFO, and major steps to console at level INFO

2013-09-21 18:53:23,471 WARNING  Expected package version file &#39;/home/gracinet/openerp/recipe/testing-buildouts/VERSION.txt&#39; does not exist. version won&#39;t be set in database at the end of upgrade. Consider including such a version file in your project *before* version dependent logic is actually needed.
2013-09-21 18:53:23,471 INFO  Database &#39;testrecipe&#39; loaded. Actual upgrade begins.
2013-09-21 18:53:23,471 INFO  Default upgrade procedure : updating all modules.
2013-09-21 18:53:54,029 INFO  Upgrade successful. Total time: 32 seconds.
</pre></div>
</div>
<p>The same with a version file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bin/upgrade_openerp -d testrecipe
Starting upgrade, logging details to /home/gracinet/openerp/recipe/testing-buildouts/upgrade.log at level INFO, and major steps to console at level INFO

2013-09-22 19:23:17,908 INFO  Read package version: 6.6.6-final from /home/gracinet/openerp/recipe/testing-buildouts/VERSION.txt
2013-09-22 19:23:17,908 INFO  Database &#39;testrecipe&#39; loaded. Actual upgrade begins.
2013-09-22 19:23:17,909 INFO  Default upgrade procedure : updating all modules.
2013-09-22 19:23:48,626 INFO  setting version 6.6.6-final in database
2013-09-22 19:23:48,635 INFO  Upgrade successful. Total time: 32 seconds.
</pre></div>
</div>
</section>
</section>
<section id="startup-scripts">
<h2>Startup scripts<a class="headerlink" href="#startup-scripts" title="Permalink to this headline">¶</a></h2>
<p>The familiar <code class="docutils literal notranslate"><span class="pre">start_openerp</span></code>, and its less pervasing siblings
(<code class="docutils literal notranslate"><span class="pre">gunicorn_openerp</span></code>, <code class="docutils literal notranslate"><span class="pre">test_openerp</span></code>, …) are also special cases of
Odoo scripts.</p>
<p>What is special with them amounts to the following:</p>
<ul class="simple">
<li><p>the entry points are declared by the recipe itself, not by a
third-party Python distribution.</p></li>
<li><p>the recipe includes some initialization code in the final
executable, in a way that the configuration presently could not allow.</p></li>
<li><p>often, they don’t use the session objects, but rewrap instead the mainline
startup script.</p></li>
</ul>
<p>In particular, you can control the names of the startup scripts with
the <code class="docutils literal notranslate"><span class="pre">openerp_scripts</span></code> option. For instance, to
replace <code class="docutils literal notranslate"><span class="pre">bin/start_openerp</span></code> with <code class="docutils literal notranslate"><span class="pre">bin/oerp</span></code>, just do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">openerp</span><span class="p">]</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">openerp_scripts</span> <span class="o">=</span> <span class="n">openerp_starter</span><span class="o">=</span><span class="n">oerp</span>
</pre></div>
</div>
</section>
<section id="list-of-internal-entry-points">
<h2>List of internal entry points<a class="headerlink" href="#list-of-internal-entry-points" title="Permalink to this headline">¶</a></h2>
<p>Here’s the list of currently available internal entry points.</p>
<dl class="field-list simple">
<dt class="field-odd">openerp_starter</dt>
<dd class="field-odd"><p>main Odoo startup script (dynamically added
behing the scenes by the recipe)</p>
</dd>
<dt class="field-even">openerp_tester</dt>
<dd class="field-even"><p>uniform script to start Odoo, launch all tests and
exit. This can be achieved with the main startup
scripts, but options differ among Odoo versions.
(also dynamically added behind the scenes).</p>
</dd>
<dt class="field-odd">openerp_upgrader</dt>
<dd class="field-odd"><p>entry point for the upgrade script</p>
</dd>
<dt class="field-even">openerp_cron_worker</dt>
<dd class="field-even"><p>entry point for the cron worker script that gets
built for gunicorn setups.</p>
</dd>
<dt class="field-odd">oe</dt>
<dd class="field-odd"><p>entry point declared by <code class="docutils literal notranslate"><span class="pre">openerp-command</span></code> and used by the recipe.</p>
</dd>
<dt class="field-even">gunicorn</dt>
<dd class="field-even"><p>entry point declared by <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code> and used by the recipe.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For these entry points, the <code class="docutils literal notranslate"><span class="pre">command-line-options</span></code> and
<code class="docutils literal notranslate"><span class="pre">arguments</span></code> modifiers have no effect.</p>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2021, &lt;a href=&#34;http://anybox.fr/&#34;&gt;Anybox SAS&lt;/a&gt;; 2021 &lt;a href=&#34;https://odoo-community.org/&#34;&gt;Odoo Community Association&lt;/a&gt; and contributors.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>